<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIå¯¹è¯åŠ©æ‰‹</title>
    <style>
        /* é¡µé¢ä¸»ä½“æ ·å¼ */
        body {
            font-family: Arial, sans-serif;    /* è®¾ç½®å­—ä½“ä¸ºArialï¼Œæ— è¡¬çº¿å­—ä½“ */
            max-width: 800px;                  /* é¡µé¢æœ€å¤§å®½åº¦é™åˆ¶ä¸º800åƒç´  */
            margin: 50px auto;                 /* ä¸Šä¸‹è¾¹è·50pxï¼Œå·¦å³è‡ªåŠ¨å±…ä¸­ */
            padding: 20px;                     /* å†…è¾¹è·20pxï¼Œç»™é¡µé¢å†…å®¹ç•™å‡ºç©ºé—´ */
            background-color: #f5f5f5;         /* é¡µé¢èƒŒæ™¯è‰²è®¾ä¸ºæµ…ç°è‰² */
        }

        /* ä¸»å®¹å™¨æ ·å¼ */
        .container {
            background: white;                  /* å®¹å™¨èƒŒæ™¯è®¾ä¸ºç™½è‰² */
            padding: 30px;                     /* å®¹å™¨å†…è¾¹è·30px */
            border-radius: 10px;               /* å®¹å™¨åœ†è§’åŠå¾„10pxï¼Œä½¿å®¹å™¨è¾¹è§’åœ†æ»‘ */
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);  /* é˜´å½±æ•ˆæœï¼šæ°´å¹³0pxï¼Œå‚ç›´2pxï¼Œæ¨¡ç³Š10pxï¼Œé€æ˜åº¦0.1çš„é»‘è‰²é˜´å½± */
        }

        /* æ ‡é¢˜æ ·å¼ */
        h1 {
            color: #333;                       /* æ ‡é¢˜é¢œè‰²è®¾ä¸ºæ·±ç°è‰² */
            text-align: center;                /* æ ‡é¢˜æ–‡å­—å±…ä¸­å¯¹é½ */
            margin-bottom: 30px;               /* æ ‡é¢˜ä¸‹æ–¹å¤–è¾¹è·30px */
        }

        /* èŠå¤©æ¡†å®¹å™¨æ ·å¼ */
        .chat-box {
            height: 400px;                     /* èŠå¤©æ¡†å›ºå®šé«˜åº¦400px */
            overflow-y: auto;                  /* å‚ç›´æ–¹å‘è¶…å‡ºæ—¶æ˜¾ç¤ºæ»šåŠ¨æ¡ */
            border: 1px solid #ddd;            /* è¾¹æ¡†ï¼š1pxå®çº¿ï¼Œæµ…ç°è‰² */
            padding: 15px;                     /* èŠå¤©æ¡†å†…è¾¹è·15px */
            margin-bottom: 20px;               /* èŠå¤©æ¡†ä¸‹æ–¹å¤–è¾¹è·20px */
            background-color: #fafafa;         /* èŠå¤©æ¡†èƒŒæ™¯è‰²ä¸ºéå¸¸æµ…çš„ç°è‰² */
            border-radius: 5px;                /* èŠå¤©æ¡†åœ†è§’åŠå¾„5px */
        }

        /* æ¶ˆæ¯é€šç”¨æ ·å¼ */
        .message {
            margin-bottom: 15px;               /* æ¯æ¡æ¶ˆæ¯ä¸‹æ–¹å¤–è¾¹è·15pxï¼Œæ¶ˆæ¯é—´éš” */
            padding: 10px;                     /* æ¶ˆæ¯å†…è¾¹è·10px */
            border-radius: 8px;                /* æ¶ˆæ¯æ°”æ³¡åœ†è§’åŠå¾„8px */
        }

        /* ç”¨æˆ·æ¶ˆæ¯æ ·å¼ */
        .user-message {
            background-color: #007bff;         /* ç”¨æˆ·æ¶ˆæ¯èƒŒæ™¯è‰²ä¸ºè“è‰² */
            color: white;                      /* ç”¨æˆ·æ¶ˆæ¯æ–‡å­—é¢œè‰²ä¸ºç™½è‰² */
            text-align: right;                 /* ç”¨æˆ·æ¶ˆæ¯æ–‡å­—å³å¯¹é½ */
            margin-left: 20%;                 /* ç”¨æˆ·æ¶ˆæ¯å·¦è¾¹è·20%ï¼Œä½¿æ¶ˆæ¯æ˜¾ç¤ºåœ¨å³ä¾§ */
        }

        /* AIæ¶ˆæ¯æ ·å¼ */
        .ai-message {
            background-color: #e9ecef;         /* AIæ¶ˆæ¯èƒŒæ™¯è‰²ä¸ºæµ…ç°è‰² */
            color: #333;                       /* AIæ¶ˆæ¯æ–‡å­—é¢œè‰²ä¸ºæ·±ç°è‰² */
            margin-right: 20%;                /* AIæ¶ˆæ¯å³è¾¹è·20%ï¼Œä½¿æ¶ˆæ¯æ˜¾ç¤ºåœ¨å·¦ä¾§ */
        }

        /* è¾“å…¥åŒºåŸŸå®¹å™¨æ ·å¼ */
        .input-group {
            display: flex;                     /* ä½¿ç”¨å¼¹æ€§å¸ƒå±€ï¼Œå­å…ƒç´ æ°´å¹³æ’åˆ— */
            gap: 10px;                         /* å­å…ƒç´ é—´éš”10px */
        }

        /* æ¶ˆæ¯è¾“å…¥æ¡†æ ·å¼ */
        #messageInput {
            flex: 1;                           /* å¼¹æ€§å¢é•¿ç³»æ•°ä¸º1ï¼Œå æ®å‰©ä½™æ‰€æœ‰ç©ºé—´ */
            padding: 12px;                     /* è¾“å…¥æ¡†å†…è¾¹è·12px */
            border: 1px solid #ddd;            /* è¾“å…¥æ¡†è¾¹æ¡†ï¼š1pxå®çº¿ï¼Œæµ…ç°è‰² */
            border-radius: 5px;                /* è¾“å…¥æ¡†åœ†è§’åŠå¾„5px */
            font-size: 16px;                   /* è¾“å…¥æ¡†å­—ä½“å¤§å°16px */
        }

        /* æŒ‰é’®é€šç”¨æ ·å¼ */
        button {
            padding: 12px 24px;                /* æŒ‰é’®å†…è¾¹è·ï¼šä¸Šä¸‹12pxï¼Œå·¦å³24px */
            background-color: #007bff;         /* æŒ‰é’®èƒŒæ™¯è‰²ä¸ºè“è‰² */
            color: white;                      /* æŒ‰é’®æ–‡å­—é¢œè‰²ä¸ºç™½è‰² */
            border: none;                      /* ç§»é™¤æŒ‰é’®é»˜è®¤è¾¹æ¡† */
            border-radius: 5px;                /* æŒ‰é’®åœ†è§’åŠå¾„5px */
            cursor: pointer;                   /* é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºæ‰‹å‹å…‰æ ‡ */
            font-size: 16px;                   /* æŒ‰é’®å­—ä½“å¤§å°16px */
        }

        /* æŒ‰é’®æ‚¬åœæ•ˆæœ */
        button:hover {
            background-color: #0056b3;         /* é¼ æ ‡æ‚¬åœæ—¶æŒ‰é’®èƒŒæ™¯è‰²å˜ä¸ºæ·±è“è‰² */
        }

        /* æŒ‰é’®ç¦ç”¨çŠ¶æ€æ ·å¼ */
        button:disabled {
            background-color: #6c757d;         /* ç¦ç”¨æ—¶æŒ‰é’®èƒŒæ™¯è‰²ä¸ºç°è‰² */
            cursor: not-allowed;               /* ç¦ç”¨æ—¶é¼ æ ‡å…‰æ ‡æ˜¾ç¤ºä¸ºç¦æ­¢ç¬¦å· */
        }

        /* åŠ è½½çŠ¶æ€æ¶ˆæ¯æ ·å¼ */
        .loading {
            color: #666;                       /* åŠ è½½æ¶ˆæ¯æ–‡å­—é¢œè‰²ä¸ºä¸­ç­‰ç°è‰² */
            font-style: italic;                /* åŠ è½½æ¶ˆæ¯æ–‡å­—æ ·å¼ä¸ºæ–œä½“ */
        }
    </style>
</head>
<body>
    <!-- ä¸»å®¹å™¨ -->
    <div class="container">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <h1>ğŸ¤– AIå¯¹è¯åŠ©æ‰‹</h1>

        <!-- å¯¹è¯æ˜¾ç¤ºåŒºåŸŸ -->
        <div id="chatBox" class="chat-box">
            <!-- åˆå§‹AIæ¬¢è¿æ¶ˆæ¯ -->
            <div class="message ai-message">
                <strong>AI:</strong> ä½ å¥½ï¼æˆ‘æ˜¯ä¸€ä¸ªå¯¹è¯æ¨¡å‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ
            </div>
        </div>

        <!-- ç”¨æˆ·è¾“å…¥åŒºåŸŸ -->
        <div class="input-group">
            <!-- æ¶ˆæ¯è¾“å…¥æ¡† -->
            <input type="text" id="messageInput" placeholder="è¾“å…¥ä½ çš„æ¶ˆæ¯..." onkeypress="handleKeyPress(event)">
            <!-- å‘é€æŒ‰é’® -->
            <button id="sendBtn" onclick="sendMessage()">å‘é€</button>
        </div>
    </div>

    <script>
        // å¤„ç†å›è½¦é”®å‘é€æ¶ˆæ¯
        function handleKeyPress(event) {
            if (event.key === 'Enter') {        // æ£€æµ‹æ˜¯å¦æŒ‰ä¸‹å›è½¦é”®
                sendMessage();                   // è°ƒç”¨å‘é€æ¶ˆæ¯å‡½æ•°
            }
        }

        // å‘é€æ¶ˆæ¯ä¸»å‡½æ•°
        function sendMessage() {
            // è·å–é¡µé¢å…ƒç´ 
            const messageInput = document.getElementById('messageInput');   // è·å–æ¶ˆæ¯è¾“å…¥æ¡†å…ƒç´ 
            const sendBtn = document.getElementById('sendBtn');             // è·å–å‘é€æŒ‰é’®å…ƒç´ 
            const chatBox = document.getElementById('chatBox');             // è·å–èŠå¤©æ¡†å…ƒç´ 

            // è·å–å¹¶å¤„ç†ç”¨æˆ·è¾“å…¥
            const message = messageInput.value.trim();                      // è·å–è¾“å…¥å†…å®¹å¹¶å»é™¤é¦–å°¾ç©ºæ ¼
            if (!message) return;                                           // å¦‚æœæ¶ˆæ¯ä¸ºç©ºåˆ™ç›´æ¥è¿”å›

            // ğŸ” è°ƒè¯•ï¼šæ‰“å°å‘é€çš„æ¶ˆæ¯
            console.log('ğŸ” å‘é€çš„æ¶ˆæ¯:', message);

            // æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
            addMessage('user', message);                                    // åœ¨èŠå¤©æ¡†ä¸­æ·»åŠ ç”¨æˆ·æ¶ˆæ¯

            // æ›´æ–°UIçŠ¶æ€
            messageInput.value = '';                                        // æ¸…ç©ºè¾“å…¥æ¡†
            sendBtn.disabled = true;                                        // ç¦ç”¨å‘é€æŒ‰é’®é˜²æ­¢é‡å¤ç‚¹å‡»
            sendBtn.textContent = 'å‘é€ä¸­...';                              // æ›´æ”¹æŒ‰é’®æ–‡å­—æ˜¾ç¤ºå‘é€çŠ¶æ€

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            addMessage('ai', 'æ­£åœ¨æ€è€ƒ...', true);                          // æ·»åŠ AIæ€è€ƒä¸­çš„æç¤ºæ¶ˆæ¯

            // å‘é€AJAXè¯·æ±‚åˆ°åç«¯
            fetch('/chat', {
                method: 'POST',                                             // ä½¿ç”¨POSTæ–¹æ³•
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',    // è®¾ç½®è¯·æ±‚å¤´ä¸ºè¡¨å•æ ¼å¼
                },
                body: `message=${encodeURIComponent(message)}`              // ç¼–ç æ¶ˆæ¯å†…å®¹ä½œä¸ºè¯·æ±‚ä½“
            })
            .then(response => {
                // ğŸ” è°ƒè¯•ï¼šæ‰“å°å“åº”çŠ¶æ€
                console.log('ğŸ” å“åº”çŠ¶æ€:', response.status, response.statusText);
                return response.json();                                     // è§£æå“åº”ä¸ºJSONæ ¼å¼
            })
            .then(data => {
                // ğŸ” è°ƒè¯•ï¼šæ‰“å°åŸå§‹å“åº”æ•°æ®
                console.log('ğŸ” åŸå§‹å“åº”æ•°æ®:', data);
                console.log('ğŸ” å“åº”æ•°æ®ç±»å‹:', typeof data);
                console.log('ğŸ” å“åº”successå­—æ®µ:', data.success);
                console.log('ğŸ” å“åº”messageå­—æ®µ:', data.message);

                // ç§»é™¤åŠ è½½æ¶ˆæ¯
                removeLoadingMessage();                                     // åˆ é™¤"æ­£åœ¨æ€è€ƒ..."æ¶ˆæ¯

                // æ ¹æ®å“åº”ç»“æœå¤„ç†
                if (data.success) {                                         // å¦‚æœè¯·æ±‚æˆåŠŸ
                    console.log('âœ… æˆåŠŸè·å–AIå›å¤:', data.message);
                    addMessage('ai', data.message);                         // æ˜¾ç¤ºAIå›å¤
                } else {                                                    // å¦‚æœè¯·æ±‚å¤±è´¥
                    console.log('âŒ åç«¯è¿”å›é”™è¯¯:', data.message);
                    addMessage('ai', 'é”™è¯¯: ' + data.message);              // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                }
            })
            .catch(error => {
                // ğŸ” è°ƒè¯•ï¼šæ‰“å°é”™è¯¯ä¿¡æ¯
                console.error('âŒ ç½‘ç»œè¯·æ±‚é”™è¯¯:', error);
                console.log('ğŸ” é”™è¯¯è¯¦æƒ…:', {
                    name: error.name,
                    message: error.message,
                    stack: error.stack
                });

                removeLoadingMessage();                                     // åˆ é™¤åŠ è½½æ¶ˆæ¯
                addMessage('ai', 'ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');                    // æ˜¾ç¤ºç½‘ç»œé”™è¯¯æç¤º
            })
            .finally(() => {
                // æ¢å¤UIçŠ¶æ€
                sendBtn.disabled = false;                                   // é‡æ–°å¯ç”¨å‘é€æŒ‰é’®
                sendBtn.textContent = 'å‘é€';                               // æ¢å¤æŒ‰é’®æ–‡å­—
                messageInput.focus();                                       // é‡æ–°èšç„¦åˆ°è¾“å…¥æ¡†
                console.log('ğŸ” è¯·æ±‚å¤„ç†å®Œæˆ');
            });
        }

        // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©æ¡†
        function addMessage(sender, message, isLoading = false) {
            const chatBox = document.getElementById('chatBox');             // è·å–èŠå¤©æ¡†å…ƒç´ 
            const messageDiv = document.createElement('div');               // åˆ›å»ºæ–°çš„æ¶ˆæ¯divå…ƒç´ 

            // è®¾ç½®æ¶ˆæ¯æ ·å¼ç±»
            messageDiv.className = `message ${sender === 'user' ? 'user-message' : 'ai-message'}`;

            // å¤„ç†åŠ è½½çŠ¶æ€
            if (isLoading) {                                                // å¦‚æœæ˜¯åŠ è½½æ¶ˆæ¯
                messageDiv.classList.add('loading');                       // æ·»åŠ åŠ è½½æ ·å¼ç±»
                messageDiv.id = 'loadingMessage';                          // è®¾ç½®IDç”¨äºåç»­åˆ é™¤
            }

            // è®¾ç½®æ¶ˆæ¯å†…å®¹
            const prefix = sender === 'user' ? 'ä½ :' : 'AI:';               // æ ¹æ®å‘é€è€…è®¾ç½®å‰ç¼€
            messageDiv.innerHTML = `<strong>${prefix}</strong> ${message}`; // è®¾ç½®æ¶ˆæ¯HTMLå†…å®¹

            // æ·»åŠ åˆ°èŠå¤©æ¡†å¹¶æ»šåŠ¨åˆ°åº•éƒ¨
            chatBox.appendChild(messageDiv);                               // å°†æ¶ˆæ¯æ·»åŠ åˆ°èŠå¤©æ¡†
            chatBox.scrollTop = chatBox.scrollHeight;                      // æ»šåŠ¨åˆ°èŠå¤©æ¡†åº•éƒ¨æ˜¾ç¤ºæœ€æ–°æ¶ˆæ¯
        }

        // ç§»é™¤åŠ è½½æ¶ˆæ¯
        function removeLoadingMessage() {
            const loadingMessage = document.getElementById('loadingMessage'); // è·å–åŠ è½½æ¶ˆæ¯å…ƒç´ 
            if (loadingMessage) {                                            // å¦‚æœåŠ è½½æ¶ˆæ¯å­˜åœ¨
                loadingMessage.remove();                                     // åˆ é™¤åŠ è½½æ¶ˆæ¯å…ƒç´ 
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('messageInput').focus();                 // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨èšç„¦åˆ°è¾“å…¥æ¡†
        });
    </script>
</body>
</html>